# Phase 6.1 統合テスト実行計画

## テスト概要

統合プラットフォーム（UnifiedGame）のすべてのゲームモードが正常に動作することを確認します。

**テスト日**: 2024年12月  
**テスト方針**: 段階的・段階的テスト（1つのシーンずつ）

---

## テスト環境

### 必要な環境
- Visual Studio 2022（C++コンパイラ）
- CMake 3.20+
- Windows 10/11

### ビルド設定
- ターゲット: `SimpleTDCGame_NewArch`
- 構成: Release
- プリセット: `vs2022-release`

---

## テスト実行手順

### 1. ビルド（前提条件）

```bash
# CMakeの再初期化
Remove-Item -Recurse -Force build -ErrorAction SilentlyContinue
cmake --preset vs2022-release

# ビルド
cmake --build build --config Release --target SimpleTDCGame_NewArch
```

**期待結果**: ビルド成功（エラー0、警告最小化）

---

## テストケース

### TC-01: ホームシーン表示テスト

**目的**: ホームシーンが正常に表示・操作できることを確認

**テスト手順**:
1. ゲームを起動
2. ホームシーンが表示されることを確認
3. 「TDゲーム」と「Roguelikeゲーム」のボタンが表示されることを確認

**期待結果**:
- ✅ ホームシーンが表示される
- ✅ UI要素（ボタン等）が表示される
- ✅ ゲームが60FPSで実行される
- ✅ メモリ使用量が200MB以下

**チェック項目**:
- [ ] ウィンドウが正常に表示される
- [ ] テキスト・ボタンが見える
- [ ] クリック入力に反応する

---

### TC-02: TDゲーム遷移テスト

**目的**: ホームシーンからTDゲームに遷移できることを確認

**テスト手順**:
1. ホームシーンで「TDゲーム」ボタンをクリック
2. TDゲームシーンに遷移されることを確認
3. 画面にTDゲーム特有の情報が表示されることを確認

**期待結果**:
- ✅ TDゲームシーンに遷移する
- ✅ Wave情報が表示される
- ✅ ゲーム状態（Base HP等）が表示される
- ✅ ゲームが60FPSで実行される

**チェック項目**:
- [ ] シーン遷移が正常に完了
- [ ] "Mode: Tower Defense" が表示される
- [ ] Wave情報が表示される
- [ ] Base HP情報が表示される
- [ ] クラッシュなし

---

### TC-03: TDゲーム基本操作テスト

**目的**: TDゲームの基本的なゲームプレイが機能することを確認

**テスト手順**:
1. TDゲーム中に、ゲーム状態が更新されることを確認
2. Waveが進行することを確認
3. 敵ユニットが出現することを確認

**期待結果**:
- ✅ 経過時間が表示される
- ✅ Waveが進行する
- ✅ 敵ユニットが表示される
- ✅ ゲーム状態が正常に遷移する

**チェック項目**:
- [ ] Elapsed時間が増加する
- [ ] Wave情報が更新される
- [ ] Base HP値が変化する
- [ ] クラッシュなし

---

### TC-04: TDゲーム終了・ホーム戻却テスト

**目的**: TDゲームからホームシーンに戻れることを確認

**テスト手順**:
1. TDゲーム中にESCキーを押す
2. ホームシーンに戻ることを確認

**期待結果**:
- ✅ ホームシーンに戻る
- ✅ ゲーム状態がリセットされる
- ✅ ゲームが正常に継続する

**チェック項目**:
- [ ] ESCキーに反応
- [ ] シーン遷移が正常に完了
- [ ] ホームシーンが表示される
- [ ] クラッシュなし

---

### TC-05: Roguelikeゲーム遷移テスト

**目的**: ホームシーンからRoguelikeゲームに遷移できることを確認

**テスト手順**:
1. ホームシーンで「Roguelikeゲーム」ボタンをクリック
2. Roguelikeゲームシーンに遷移されることを確認
3. 画面にRoguelike特有の情報が表示されることを確認

**期待結果**:
- ✅ Roguelikeゲームシーンに遷移する
- ✅ ターン情報が表示される
- ✅ ダンジョンマップが表示される
- ✅ ゲームが60FPSで実行される

**チェック項目**:
- [ ] シーン遷移が正常に完了
- [ ] "Mode: Roguelike" が表示される
- [ ] ターン情報が表示される
- [ ] ダンジョンマップが表示される
- [ ] クラッシュなし

---

### TC-06: Roguelikeゲーム基本操作テスト

**目的**: Roguelikeゲームの基本的なゲームプレイが機能することを確認

**テスト手順**:
1. Roguelike中にプレイヤー移動入力を行う
2. ターン情報が更新されることを確認
3. ダンジョンマップが正常に表示されることを確認

**期待結果**:
- ✅ ターン数が増加する
- ✅ プレイヤー移動に反応する
- ✅ ダンジョン要素（壁、床）が表示される
- ✅ ゲーム状態が正常に遷移する

**チェック項目**:
- [ ] ターン数が表示・更新される
- [ ] プレイヤーエンティティが表示される
- [ ] マップが正常に描画される
- [ ] クラッシュなし

---

### TC-07: Roguelikeゲーム終了・ホーム戻却テスト

**目的**: Roguelikeゲームからホームシーンに戻れることを確認

**テスト手順**:
1. Roguelike中にESCキーを押す
2. ホームシーンに戻ることを確認

**期待結果**:
- ✅ ホームシーンに戻る
- ✅ ゲーム状態がリセットされる
- ✅ ゲームが正常に継続する

**チェック項目**:
- [ ] ESCキーに反応
- [ ] シーン遷移が正常に完了
- [ ] ホームシーンが表示される
- [ ] クラッシュなし

---

### TC-08: 複数シーン遷移テスト

**目的**: シーン間の複数遷移が正常に機能することを確認

**テスト手順**:
1. TDゲーム → ホーム → Roguelikeゲーム → ホーム → TDゲーム の順序で遷移
2. 各遷移が正常に完了することを確認
3. メモリリークがないことを確認

**期待結果**:
- ✅ 全ての遷移が正常に完了
- ✅ メモリ使用量が安定している
- ✅ パフォーマンスが安定している（60FPS）

**チェック項目**:
- [ ] 複数遷移が正常に完了
- [ ] メモリ使用量が異常増加しない
- [ ] フレームレートが安定している
- [ ] クラッシュなし

---

### TC-09: HTTPサーバー + 開発者モード統合テスト

**目的**: HTTPサーバーを有効化した状態でゲームが正常に動作することを確認

**テスト手順**:
1. `main_unified.cpp` で `enableHTTPServer = true` に変更
2. ビルド・実行
3. WebUIエディターで開発者モード機能にアクセス可能か確認

**期待結果**:
- ✅ ゲームが正常に実行される
- ✅ HTTPサーバーが起動する（ポート8080）
- ✅ WebUIエディターからAPIにアクセスできる

**チェック項目**:
- [ ] HTTPサーバーが起動する
- [ ] API エンドポイントが応答する（例: /api/game/state）
- [ ] ゲーム動作に影響しない
- [ ] クラッシュなし

---

## テスト環境・ツール

### パフォーマンス測定

**FPS測定**:
- ゲーム画面左上に表示される（Raylibの標準機能）
- 期待値: 60FPS（±2）

**メモリ測定**:
- Windows タスクマネージャーで確認
- 期待値: 200MB以下

### ログ・デバッグ出力

**ゲーム起動時のログ**:
```
UnifiedGame: Initialized
HomeScene: Initialized successfully
...
```

**シーン遷移時のログ**:
```
UnifiedGame: Scene changed to: TDGame
TDGameScene: Initializing...
TDGameScene: Initialized successfully
```

---

## テスト結果報告テンプレート

### テストケース結果

| TC番号 | テスト項目 | 状態 | 備考 |
|--------|----------|------|-----|
| TC-01 | ホームシーン表示 | 🟢 | - |
| TC-02 | TDゲーム遷移 | 🟢 | - |
| TC-03 | TDゲーム基本操作 | 🟢 | - |
| TC-04 | TDゲーム終了 | 🟢 | - |
| TC-05 | Roguelike遷移 | 🟢 | - |
| TC-06 | Roguelike基本操作 | 🟢 | - |
| TC-07 | Roguelike終了 | 🟢 | - |
| TC-08 | 複数遷移 | 🟢 | - |
| TC-09 | 開発者モード統合 | 🟢 | - |

**総合評価**: ✅ 合格

---

## 既知の制限・バグ

### 既知の問題
- [ ] グラフィック描画の簡易実装（最小限UI）
- [ ] ゲーム終了条件の簡易実装
- [ ] 敵AI の基本実装のみ

### 今後の改善
- [ ] グラフィック品質向上
- [ ] エラーハンドリング強化
- [ ] パフォーマンス最適化

---

**テスト計画作成日**: 2024年12月  
**テスト方針**: 段階的・結果指向テスト  
**ステータス**: 🟡 テスト準備中

