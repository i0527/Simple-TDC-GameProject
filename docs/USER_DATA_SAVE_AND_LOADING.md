## セーブ/ロード基盤（方針まとめ）

### ユーザデータマネージャー（仮）

- 役割: 0〜99 のセーブスロットを JSON ファイルで読み書きする。保存対象の値を保持し、シリアライズ/デシリアライズとバージョン整合チェックを行う。
- スロット: `slot_id` は 0 がオートセーブ予定（未実装のまま継続）、1〜99 が手動セーブ想定。
- JSON 保存例（たたき台）

  ```json
  {
    "version": 1,
    "slot_id": 12,
    "saved_at": "2025-12-09T12:34:56Z",
    "stage_progress": {
      "cleared_stage_ids": ["stage_debug", "stage_horde_1"]
    },
    "characters": [
      { "id": "char_001", "level": 7, "exp": 12345, "upgrades": ["atk_1", "hp_2"] }
    ],
    "gold": 12340,
    "tower": {
      "hp_level": 3
    },
    "meta": {
      "save_manager_version": 1
    }
  }
  ```

- バージョン管理: `version` と `meta.save_manager_version` を持ち、未知フィールドは無視、欠損はデフォルトで補う後方互換を基本とする。
- データ配置: セーブファイルのディレクトリと命名規則を決める（例: `saves/slot_{id}.json`）。オートセーブは `slot_0.json`。

## ロードフローとアセット戦略

- 方針: 起動時にロードシーンを挟み、全アセット先読み → 完了後タイトルへ自動遷移。
- ロードシーンで扱うリソース（例）
  - フォント（日本語フォント）
  - BGM/SE
  - テクスチャ/スプライトシート
  - 定義 JSON（entities/skills/stages/waves/abilities）
  - シェーダやプリセットがあれば同時に
- 進捗/状態表示: ロードシーンは「ロード中」であることと完了をユーザーに通知する最低限の UI を持つ（プログレスバー簡易でも可）。
- 完了判定: 上記リソースの読み込みが成功したらタイトルへ自動遷移。失敗時はエラーメッセージ表示と再試行/終了のどちらかへ誘導。

## UIスケール / 解像度ポリシー

- レイアウトは FHD (1920x1080) 固定座標で制御する。
- 許容する画面モード: FHD ウィンドウ or FHD フルスクリーンのみ。スケーリングや可変解像度対応は行わない。
- 将来スケールが必要になった場合のガイド: アスペクト比を保ち、整数倍/等倍のみで拡大縮小する簡易スケールを検討（現時点では実装しない）。

## 拡張・互換メモ

- セーブ項目追加時のルール:
  - 既存キーは変更しない。追加は新しいキーで行う。
  - デフォルト値を決め、欠損時に補完できるようにする。
  - `version`（保存データ）または `save_manager_version`（管理側）を必要に応じてインクリメントし、移行処理を用意。
- ロード失敗/整合性チェック:
  - JSON 破損・不正時は該当スロットをスキップまたは初期化（ユーザーに通知）。
  - バージョン不一致時は既知の範囲ならデフォルト補完、未知バージョンは読み込みを拒否して初期化か別扱い（要ログ出力）。
