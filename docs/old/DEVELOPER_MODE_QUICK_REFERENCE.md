# 開発者モード クイックリファレンス

## 概要

開発者モードは、ゲーム内で完結する統合開発環境です。F1キーで起動し、エンティティ、ステージ、イベント、UIをリアルタイムで編集できます。

## キーボードショートカット

| キー | 機能 |
|-----|------|
| **F1** | 開発者モード ON/OFF |
| **F2** | ゲームビューのフォーカス切り替え |
| **F3** | コンソール表示切り替え |
| **F5** | ホットリロード手動実行 |
| **Ctrl+S** | 現在編集中のデータを保存 |
| **Ctrl+Shift+S** | ワークスペースを保存 |
| **Ctrl+Shift+L** | ワークスペースを読み込み |
| **Ctrl+N** | 新規作成 |
| **Ctrl+D** | 複製 |
| **Delete** | 削除 |

## ウィンドウ構成

### メインウィンドウ

```
┌─────────────────────────────────────────────────────┐
│ [File] [Edit] [View] [Window] [Help]    [Play] [⏸] │ ← メニューバー
├──────────────┬──────────────────────────────────────┤
│              │                                      │
│  Hierarchy   │       Game View                     │
│              │                                      │
│ ○ Stage      │  [ゲーム画面 FHD 1920x1080]          │
│   ├○ Player  │                                      │
│   ├○ Enemy1  │                                      │
│   └○ Enemy2  │                                      │
│              │                                      │
├──────────────┼──────────────────────────────────────┤
│              │                                      │
│ Entity Editor│       Inspector                     │
│              │                                      │
│ [List]       │  Selected: Enemy1                    │
│ Soldier      │  HP: 100                             │
│ Archer  ←    │  Speed: 50                           │
│ Tank         │  Sprite: idle                        │
│              │                                      │
├──────────────┴──────────────────────────────────────┤
│                 Console                             │
│ [Info] Loaded character: soldier.char.json          │
│ [Warn] Animation 'attack' has no events             │
└─────────────────────────────────────────────────────┘
```

### 利用可能なウィンドウ

| ウィンドウ名 | 説明 | 主な機能 |
|------------|------|---------|
| **Game View** | ゲーム本体の表示 | プレビュー、デバッグ描画 |
| **Entity Editor** | エンティティ編集 | 作成、編集、プレビュー |
| **Stage Editor** | ステージ編集 | Wave設定、配置 |
| **Event Editor** | イベント編集 | トリガー、アクション |
| **UI Editor** | UI編集 | レイアウト、スタイル |
| **Inspector** | オブジェクト詳細 | プロパティ編集 |
| **Hierarchy** | エンティティ階層 | 選択、表示/非表示 |
| **Console** | ログ表示 | エラー、警告、情報 |
| **Asset Browser** | アセット管理 | ファイル一覧、プレビュー |

## エンティティエディタ

### 基本操作

1. **新規作成**: `Ctrl+N` または [新規作成] ボタン
2. **編集**: リストから選択 → 右パネルで編集
3. **保存**: `Ctrl+S` または [保存] ボタン
4. **削除**: 選択 → `Delete`

### エンティティ定義の構成要素

```
エンティティ
├─ 基本情報 (ID、名前、説明)
├─ スプライト
│  ├─ idle (待機)
│  ├─ walk (移動)
│  ├─ attack (攻撃)
│  └─ death (死亡)
├─ ステータス
│  ├─ HP
│  ├─ 速度
│  ├─ 攻撃力
│  └─ 攻撃範囲
├─ 行動AI
│  ├─ 状態定義
│  └─ 遷移条件
└─ サウンド
   ├─ spawn
   ├─ attack
   └─ death
```

### スプライトアニメーション設定

```
┌─────────────────────────────────────┐
│ Animation: attack                   │
├─────────────────────────────────────┤
│ Texture: [assets/sprites/...] [📁] │
│ Frame Count: [8]                    │
│ Frame Duration: [0.1] sec           │
│ Loop: [✓]                           │
│                                     │
│ ┌─ Timeline ─────────────────────┐ │
│ │ 0  1  2  3  4  5  6  7         │ │
│ │ │──│──│──│──│──│──│──│         │ │
│ │       ♪     ⚔  💥              │ │
│ │      F3    F4  F5              │ │
│ └───────────────────────────────┘ │
│                                     │
│ [+ Add Event]                       │
└─────────────────────────────────────┘
```

### アニメーションイベント

| アイコン | タイプ | 説明 | パラメータ |
|---------|-------|------|-----------|
| ⚔ | Damage | ダメージ | value |
| ♪ | Sound | サウンド再生 | soundId |
| 💥 | Effect | エフェクト | effectId, offsetX, offsetY |
| 👤 | Spawn | エンティティ生成 | entityId, offsetX, offsetY |
| ❤ | Heal | HP回復 | value |
| ➡ | State | 状態遷移 | targetState |

## ステージエディタ

### Wave編集

```
┌─────────────────────────────────────┐
│ Stage: stage_001                    │
├─────────────────────────────────────┤
│ Wave 1  [+]                         │
│ ┌─────────────────────────────────┐│
│ │ Entity: [Soldier ▼]             ││
│ │ Count: [5]                      ││
│ │ Interval: [2.0] sec             ││
│ │ Delay: [0.0] sec                ││
│ │ Lane: [1 ▼]                     ││
│ │                   [削除]         ││
│ └─────────────────────────────────┘│
│                                     │
│ Wave 2  [+]                         │
│ Wave 3  [+]                         │
│                                     │
│ [▶ Preview] [⏹ Stop]                │
└─────────────────────────────────────┘
```

### プレビュー機能

- **通常再生**: Wave進行を実速度で確認
- **2倍速**: 素早くバランス確認
- **ステップ実行**: 1Wave単位で確認
- **デバッグ表示**: 範囲、HP、状態を可視化

## 行動AI (ステートマシン)

### ビジュアルエディタ

```
┌─────────────────────────────────────┐
│ Behavior: melee_fighter             │
├─────────────────────────────────────┤
│                                     │
│     ┌──────┐                        │
│  ┌─→│ Idle │←─┐                     │
│  │  └──────┘  │                     │
│  │      │     │                     │
│  │      │ enemy_in_range            │
│  │      ↓     │                     │
│  │  ┌────────┐│                     │
│  │  │ Attack ││                     │
│  │  └────────┘│                     │
│  │      │     │                     │
│  │ animation  │                     │
│  │ _finished  │                     │
│  │      │     │                     │
│  │      ↓     │ always              │
│  │  ┌──────┐  │                     │
│  └──│ Walk │──┘                     │
│     └──────┘                        │
│                                     │
│ [Add State] [Add Transition]        │
└─────────────────────────────────────┘
```

### 状態定義

選択した状態のプロパティ:

```
State: Attack
├─ Sprite: attack
├─ Move Speed: 0
├─ On Enter:
│  └─ reset_attack_cooldown
├─ On Exit:
│  └─ (なし)
└─ Transitions:
   └─ animation_finished → idle
```

### 遷移条件

| 条件 | パラメータ | 説明 |
|-----|----------|------|
| `enemy_in_range` | range | 敵が範囲内にいる |
| `no_enemy_in_range` | range | 敵が範囲外 |
| `hp_below` | percentage | HPが指定%以下 |
| `cooldown_ready` | cooldownId | クールダウン完了 |
| `animation_finished` | - | アニメーション終了 |
| `distance_to_base` | distance | 拠点までの距離 |
| `random` | probability | ランダム (0.0-1.0) |
| `always` | - | 常に真 |

## ホットリロード

### 自動リロード

JSONファイルを外部エディタで保存すると、自動的にゲームに反映されます。

**対応ファイル**:
- `*.char.json` - エンティティ定義
- `*.stage.json` - ステージ定義
- `*.ui.json` - UIレイアウト
- `*.event.json` - イベント定義

### 手動リロード

`F5` キーでファイル変更を強制的に再読み込みします。

### リロード時の動作

1. **成功時**: コンソールに `[Info] Reloaded: xxx.json` と表示
2. **失敗時**: 
   - コンソールに `[Error] Failed to reload: xxx.json` と表示
   - 前回の正常な状態を維持
   - エラー詳細を表示

## ワークスペース

### デフォルトレイアウト

- **Default**: 標準レイアウト
- **Coding**: エンティティ編集に最適化
- **Level Design**: ステージ編集に最適化
- **Debug**: デバッグ情報を多く表示

### カスタムワークスペース

1. ウィンドウを好みの配置に調整
2. `Window` → `Save Workspace As...`
3. 名前を入力して保存

ワークスペースは `assets/workspaces/` に保存されます。

## プレビュー機能

### エンティティプレビュー

1. Entity Editorでエンティティを選択
2. [Preview] ボタンをクリック
3. Game View内でアニメーション再生

**プレビューモード**:
- **Idle**: 待機アニメーション
- **Walk**: 移動アニメーション
- **Attack**: 攻撃アニメーション（ループ）
- **All States**: すべての状態を順番に再生

### ステージプレビュー

1. Stage Editorでステージを選択
2. [▶ Preview] ボタンをクリック
3. Wave進行を確認

**コントロール**:
- **▶**: 再生/再開
- **⏸**: 一時停止
- **⏹**: 停止
- **⏩**: 2倍速
- **⏭**: 次のWaveへスキップ

## デバッグ機能

### デバッグ描画

Game View で右クリック → `Debug Draw` で表示項目を選択:

- [ ] Entity Bounds (エンティティの境界)
- [ ] Attack Range (攻撃範囲)
- [ ] Movement Path (移動経路)
- [ ] HP Bars (HPバー)
- [ ] State Info (状態情報)
- [ ] Collision (衝突判定)

### コンソールフィルタ

```
[🔍] Search: [_________]  [Clear]

Filter: [Info ✓] [Warning ✓] [Error ✓]

───────────────────────────────────────
[Info ] 12:34:56 - Loaded stage_001
[Warn ] 12:35:02 - Low HP: Enemy1
[Error] 12:35:10 - Invalid JSON: bad.json
```

## トラブルシューティング

### ホットリロードが動作しない

1. ファイルパスが正しいか確認
2. `F5` で手動リロード
3. コンソールでエラーメッセージを確認

### エンティティが表示されない

1. スプライトパスが正しいか確認
2. テクスチャファイルが存在するか確認
3. Inspector でコンポーネントを確認

### アニメーションイベントが発火しない

1. フレーム番号が範囲内か確認 (0 〜 frameCount-1)
2. アニメーションがループしているか確認
3. イベントタイプとパラメータが正しいか確認

## Tips

### 効率的なワークフロー

1. **デュアルモニタ**: ゲームビューとエディタを別々に配置
2. **ワークスペース**: タスクごとに専用レイアウトを作成
3. **ホットリロード**: 外部エディタと併用して素早く編集
4. **プレビュー**: 小まめにプレビューして動作確認

### ショートカットのカスタマイズ

`Settings` → `Keyboard Shortcuts` でショートカットをカスタマイズできます。

### パフォーマンス

- エディタ使用時はゲームの更新レートが下がる場合があります
- プレビュー時は `Vsync` を無効化すると快適です

## 関連ドキュメント

- [開発者モード設計書](DEVELOPER_MODE_DESIGN.md)
- [TD専用エンティティ動作システム](TD_ENTITY_BEHAVIOR_SYSTEM.md)
- [WebUI移行ガイド](WEBUI_TO_INGAME_EDITOR_MIGRATION.md)
