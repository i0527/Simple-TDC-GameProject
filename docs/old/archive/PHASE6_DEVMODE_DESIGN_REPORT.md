# Phase 6 完了レポート: 開発者モード設計書作成

## 概要

WebUIを廃止し、ゲーム内に統合された開発者モードを実装するための包括的な設計ドキュメントを作成しました。TD専用のにゃんこ大戦争風のシンプルなゲーム開発環境を目指し、レベルデザイナーが効率的に作業できるよう設計されています。

## 作成したドキュメント

### 1. DEVELOPER_MODE_DESIGN.md（開発者モード設計書）

**内容**:

- WebUI廃止の理由と開発者モードの目標
- レンダリング階層構造（RenderTextureによるゲーム画面とエディタUIの分離）
- Asepriteライクなウィンドウ管理システム
- 8種類のエディタウィンドウ仕様
- ホットリロードシステム設計
- 実装計画（6フェーズ）

**特徴**:

- FHD固定のゲーム画面を独立したRenderTextureに描画
- ImGuiのDockSpaceを活用した自由なウィンドウ配置
- ワークスペース保存・読み込み機能
- ファイル変更の自動検知とリアルタイム反映

### 2. TD_ENTITY_BEHAVIOR_SYSTEM.md（TD専用エンティティ動作システム）

**内容**:

- にゃんこ大戦争風のシンプルなエンティティ動作定義
- ステートマシンベースのAI実装
- アニメーションイベントシステム（ダメージ、サウンド、エフェクト同期）
- JSON定義フォーマットとスキーマ
- ビジュアルステートマシンエディタ仕様
- アニメーションタイムラインエディタ仕様

**特徴**:

- シンプルなJSON定義でエンティティの動作を完全に制御
- 状態遷移条件の柔軟な定義
- アニメーションの特定フレームでイベント発火
- プレビュー機能でリアルタイム確認

### 3. WEBUI_TO_INGAME_EDITOR_MIGRATION.md（WebUI移行ガイド）

**内容**:

- WebUIの問題点とゲーム内エディタの利点
- 6フェーズの移行計画
- HTTPServer機能とエディタ機能のマッピング
- データアクセス層の共通化
- ホットリロード実装詳細
- エディタ実装例（EntityEditor）
- 移行チェックリスト

**特徴**:

- 段階的な移行により既存機能を維持
- データアクセス層を共通化してコード重複を削減
- 詳細なコード例で実装をガイド

### 4. DEVELOPER_MODE_QUICK_REFERENCE.md（クイックリファレンス）

**内容**:

- キーボードショートカット一覧
- ウィンドウ構成と操作方法
- エンティティエディタの使い方
- ステージエディタの使い方
- ステートマシンエディタの使い方
- ホットリロードの動作
- ワークスペース管理
- トラブルシューティング

**特徴**:

- 初心者でも理解しやすい図解
- 実践的なTips
- エラー対処方法

### 5. DEVELOPER_MODE_IMPLEMENTATION_ROADMAP.md（実装ロードマップ）

**内容**:

- 8週間の詳細な実装計画
- 各フェーズのタスク、検証項目、依存関係
- Phase 1: 基盤構築（2週間）
- Phase 2: ホットリロード（1週間）
- Phase 3: エンティティエディタ（2週間）
- Phase 4: ステージエディタ（1週間）
- Phase 5: その他エディタ（1週間）
- Phase 6: 最適化・仕上げ（1週間）
- リスク管理と成功基準

**特徴**:

- 実装可能な具体的なタスク分割
- 各タスクの検証項目を明記
- リスクと対策を事前に洗い出し

## アーキテクチャの特徴

### レンダリング分離

```
メインウィンドウ
├── ゲーム本体（RenderTexture、FHD固定）
│   └── ゲームシーン描画
└── エディタUI（ImGui、DockSpace）
    ├── Game View ウィンドウ
    ├── Entity Editor
    ├── Stage Editor
    └── その他のエディタ
```

**メリット**:

- ゲーム画面とエディタUIが互いに干渉しない
- ゲームの解像度を固定してエディタと座標系を統一
- エディタウィンドウを自由に配置可能

### ホットリロードシステム

```cpp
// ファイル変更検知
HotReloadSystem::Update()
  → CheckFileChanges()
  → NotifyCallbacks(filepath)
  → DefinitionLoader::ReloadXXX()
  → Editor::RefreshList()
```

**メリット**:

- 外部エディタで編集してもゲームに即座に反映
- エラー時は前の状態を維持
- コンソールに詳細なログ出力

### TD専用エンティティシステム

```json
{
  "entityId": "soldier",
  "sprites": { "idle": {...}, "attack": {...} },
  "stats": { "maxHp": 100, "speed": 50 },
  "behavior": {
    "states": {
      "idle": { "transitions": [...] },
      "attack": { "sprite": "attack", "events": [...] }
    }
  }
}
```

**メリット**:

- プログラマーでなくても編集可能
- ビジュアルエディタで直感的に編集
- にゃんこ大戦争のようなシンプルなTDに最適

## 技術選定

| 技術 | 用途 | 理由 |
|-----|------|------|
| **ImGui** | エディタUI | 業界標準、Docking対応、豊富なウィジェット |
| **rlImGui** | Raylib統合 | RaylibとImGuiの統合ライブラリ |
| **RenderTexture2D** | ゲーム画面分離 | エディタと独立した描画領域 |
| **std::filesystem** | ファイル監視 | C++17標準ライブラリ、クロスプラットフォーム |
| **nlohmann/json** | JSON定義 | 既存システムと統一 |

**追加検討**:

- **ImNodes** (オプション) - ステートマシンのビジュアル編集に使用可能

## 実装優先度

### 必須（MVP）

1. ✅ DevModeManager（開発者モードON/OFF）
2. ✅ RenderTexture分離
3. ✅ HotReloadSystem
4. ✅ EntityEditor（基本CRUD）
5. ✅ StageEditor（Wave編集）

### 望ましい

6. ⭐ アニメーションタイムラインエディタ
7. ⭐ ビジュアルステートマシンエディタ
8. ⭐ リアルタイムプレビュー
9. ⭐ ワークスペース管理

### オプション

10. 🔸 EventEditor（イベント制作）
11. 🔸 UIEditor（UI定義）
12. 🔸 デバッグビジュアライゼーション

## 期待される効果

### 開発効率の向上

- **ホットリロード**: 外部エディタで編集 → 自動反映 → 即座に確認
- **プレビュー機能**: エディタ内でアニメーション・Wave進行を確認
- **ワークスペース**: タスクごとに最適なレイアウトを保存

### レベルデザイナーの生産性向上

- **ビジュアルエディタ**: コードを書かずにエンティティ定義
- **リアルタイムフィードバック**: 変更が即座にゲームに反映
- **直感的なUI**: Asepriteライクな使いやすいインターフェース

### コードベースの簡素化

- **HTTPServer削除**: 複雑なサーバー管理が不要
- **単一プロセス**: 同期の問題が解消
- **配布簡素化**: 実行ファイル単体で完結

## 今後の展開

### Phase 7（実装フェーズ）

8週間で開発者モードを実装:

```
Week 1-2: 基盤構築
Week 3:   ホットリロード
Week 4-5: エンティティエディタ
Week 6:   ステージエディタ
Week 7:   統合テスト
Week 8:   最適化・ドキュメント
```

### Phase 8（完成）

- TD専用ゲーム制作環境の完成
- WebUI完全削除
- HTTPServer完全削除
- 実行ファイル単体での配布

## まとめ

WebUIを廃止し、ゲーム内に統合された開発者モードを実装することで、以下のメリットを得られます:

1. **開発効率**: ホットリロードとプレビューで即座にフィードバック
2. **使いやすさ**: Asepriteライクな直感的なUI
3. **生産性**: レベルデザイナーがコードを書かずに開発可能
4. **シンプル化**: サーバー不要、単一プロセス、配布簡素化

包括的な設計ドキュメントにより、実装フェーズへの移行がスムーズに行えます。

---

**作成日**: 2025-12-04  
**作成者**: GitHub Copilot  
**ステータス**: 設計完了、実装準備完了
